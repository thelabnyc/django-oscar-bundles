!function(){"use strict";var e,t,n,r={376:function(e,t,n){n(9848);var r=n(8912),s=n(7582),i=n(1635),a=n(7183),l=n.n(a),o=n(1540),c=n.n(o),d=n(8987),u=n(346),g=n(231),p=n(2666);const h=e=>{if((0,p.isLeft)(e))throw new Error((0,g.V2)(e.left).join("\n"));return e.right},m=e=>u.KC([u.ch,e]),b=e=>u.KC([u.Vx,e]);class E extends u.ZU{constructor(){super("number",(e=>e instanceof File),((e,t)=>this.is(e)?u.kX(e):u.V2(e,t)),u.D_),this._tag="NumberType"}}const f=new E,v=u.qO({value:u.Yj,display_name:u.Yj}),y=u.QZ(v),_=e=>u.qO({type:e,required:u.zM,read_only:u.zM,label:u.Yj,help_text:b(u.Yj)}),C=_(u.eu("integer")),P=_(u.eu("boolean")),x=_(u.eu("datetime")),S=u.E$([_(u.eu("string")),u.qO({max_length:b(u.ai)})]),O=u.E$([_(u.eu("choice")),u.qO({choices:y})]),N=u.KC([C,P,x,S,O,u.L5]),j=(u.KC([u.eu("GET"),u.eu("HEAD"),u.eu("OPTIONS"),u.eu("POST"),u.eu("PUT"),u.eu("PATCH"),u.eu("DELETE")]),u.qO({name:u.Yj,description:u.Yj,renders:u.QZ(u.Yj),parses:u.QZ(u.Yj),actions:u.qO({GET:b(u.g1(u.Yj,N)),HEAD:b(u.g1(u.Yj,N)),OPTIONS:b(u.g1(u.Yj,N)),POST:b(u.g1(u.Yj,N)),PUT:b(u.g1(u.Yj,N)),PATCH:b(u.g1(u.Yj,N)),DELETE:b(u.g1(u.Yj,N))})})),T=u.qO({id:u.ai,dashboard_url:u.Yj,product_class:m(u.qO({id:u.ai,name:u.Yj})),title:u.Yj,slug:u.Yj,is_parent:u.zM,is_child:u.zM,parent:m(u.ai),children:u.YO(u.ai)}),k=u.YO(T),w=u.qO({id:u.ai,dashboard_url:u.Yj,name:u.Yj,slug:u.Yj,description:u.Yj}),R=u.YO(w),I=u.qO({id:m(u.ai),triggering_product:u.ai,suggested_products:u.YO(u.ai)}),A=(u.YO(I),u.qO({id:m(u.ai),triggering_product:u.ai,suggested_range:u.ai,quantity:u.ai})),L=(u.YO(A),u.qO({id:m(u.ai),bundle_type:u.Yj,name:u.Yj,description:u.Yj,is_active:b(m(u.zM)),headline:u.Yj,image:b(m(u.Yj)),newImage:b(m(f)),clearImage:b(u.zM),triggering_parents:u.YO(u.ai),suggested_parents:u.YO(u.ai),concrete_bundles:u.YO(I),user_configurable_bundles:u.YO(A)})),D=u.YO(L),Y="X-CSRFToken",G=function(){return d.A.get("csrftoken")||""},M=e=>(0,i.sH)(void 0,void 0,void 0,(function*(){return fetch(e,{method:"GET",headers:{Accept:"application/json"}})})),F=e=>(0,i.sH)(void 0,void 0,void 0,(function*(){const t=yield M(e);return h(D.decode(yield t.json()))})),q=e=>(0,i.sH)(void 0,void 0,void 0,(function*(){const t=yield M(e);return h(k.decode(yield t.json()))})),B=e=>(0,i.sH)(void 0,void 0,void 0,(function*(){const t=yield M(e);return h(R.decode(yield t.json()))}));class H extends r.PureComponent{render(){return r.createElement("div",{className:"card card-body bg-light"},r.createElement("form",{className:"form-inline",onSubmit:function(e){e.preventDefault()}},r.createElement("span",{className:"form-group"},r.createElement("label",{htmlFor:"id_text"},gettext("Search:")),r.createElement("input",{className:"form-control",id:"id_text",value:this.props.searchText,onChange:e=>{e.preventDefault(),this.props.onChange(e.currentTarget.value)}}))," ",r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:e=>{e.preventDefault(),this.props.onChange("")}},gettext("Clear Search"))))}}var U=H,$=n(1906),Q=n.n($);class z extends r.PureComponent{buildFormGroupClasses(e){const t=this.props.errors[e],n={"form-group":!0,"has-error":!!t&&t.length>0};return Q()(n)}buildErrors(e){return(this.props.errors[e]||[]).map(((e,t)=>r.createElement("span",{key:t,className:"help-block"},r.createElement("i",{className:"fas fa-exclamation"})," ",e)))}buildCurrentImage(){if(!this.props.group||!this.props.group.image)return null;const e=this.props.group.image.split("/"),t=e[e.length-1];return r.createElement("span",null,gettext("Currently:")," ",r.createElement("a",{target:"_blank",rel:"noreferrer",href:this.props.group.image},t)," ",r.createElement("input",{type:"checkbox",id:"bundle-edit-form-clear-img",checked:this.props.clearImage,onChange:this.props.onClearImage,disabled:this.props.isSaving})," ",r.createElement("label",{htmlFor:"bundle-edit-form-clear-img"},gettext("Clear")))}render(){const e=this.props.group?gettext("Edit Bundle Group"):gettext("Create Bundle Group");return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,e),r.createElement("div",{className:this.buildFormGroupClasses("bundleType")},r.createElement("label",{htmlFor:"id_bundleType",className:"control-label"},gettext("Bundle Type")),r.createElement("div",null,r.createElement("select",{id:"id_bundleType",name:"bundleType",className:"form-control",value:this.props.bundleType,onChange:this.props.onEdit,disabled:this.props.isSaving},this.props.bundleTypeChoices.map((e=>r.createElement("option",{key:e.value,value:e.value},e.display_name)))),this.buildErrors("bundleType"))),r.createElement("div",{className:this.buildFormGroupClasses("name")},r.createElement("label",{htmlFor:"id_name",className:"control-label"},gettext("Name")),r.createElement("div",null,r.createElement("input",{id:"id_name",name:"name",maxLength:200,className:"form-control",value:this.props.name,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("name"))),r.createElement("div",{className:this.buildFormGroupClasses("headline")},r.createElement("label",{htmlFor:"id_headline",className:"control-label"},gettext("Headline")),r.createElement("div",null,r.createElement("textarea",{id:"id_headline",name:"headline",cols:40,rows:4,className:"form-control",value:this.props.headline,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("headline"))),r.createElement("div",{className:this.buildFormGroupClasses("isActive")},r.createElement("label",{htmlFor:"id_active_status",className:"control-label"},gettext("Active Status")),r.createElement("div",null,r.createElement("select",{id:"id_isActive",name:"isActive",className:"form-control",value:String(this.props.isActive),onChange:this.props.onEdit,disabled:this.props.isSaving},[{display_name:"Active",value:"true"},{display_name:"Inactive",value:"false"}].map(((e,t)=>r.createElement("option",{key:t,value:e.value},e.display_name)))),this.buildErrors("isActive"))),r.createElement("div",{className:this.buildFormGroupClasses("description")},r.createElement("label",{htmlFor:"id_description",className:"control-label"},gettext("Description")),r.createElement("div",null,r.createElement("textarea",{id:"id_description",name:"description",cols:40,rows:4,className:"form-control",value:this.props.description,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("description"))),r.createElement("div",{className:this.buildFormGroupClasses("image")},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Image")),r.createElement("div",null,this.buildCurrentImage(),r.createElement("input",{id:"id_image",type:"file",name:"image",className:"form-control",onChange:this.props.onSelectImage,disabled:this.props.isSaving}),this.buildErrors("image"))))}}var K=n(9066);class Z extends r.PureComponent{getParentProductSelectOptions(){return this.props.products.filter((e=>!e.is_child)).sort(((e,t)=>e.title.localeCompare(t.title))).map((e=>({value:e.id,label:e.title})))}buildFormGroupClasses(e,t){const n=this.props.errors[e],r={"form-group":!0,"has-error":!!n&&n.length>0};return t.forEach((e=>{r[e]=!0})),Q()(r)}buildErrors(e){return(this.props.errors[e]||[]).map(((e,t)=>r.createElement("span",{key:t,className:"help-block"},r.createElement("i",{className:"fas fa-exclamation"})," ",e)))}render(){const e=this.getParentProductSelectOptions();return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Relevant Products")),r.createElement("p",null,r.createElement("em",null,gettext("Select the parent and standalone products revelant to this bundle group."))),r.createElement("div",{className:"row"},r.createElement("div",{className:this.buildFormGroupClasses("triggering_parents",["col-sm-6"])},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Triggers")),r.createElement("div",null,r.createElement(K.Ay,{name:"triggeringParents",isMulti:!0,value:e.filter((e=>this.props.triggeringParents.includes(e.value))),onChange:this.props.onSelectParent.bind(this,"triggeringParents"),options:e,isDisabled:this.props.isSaving}),this.buildErrors("triggering_parents"))),r.createElement("div",{className:this.buildFormGroupClasses("suggested_parents",["col-sm-6"])},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Suggestions")),r.createElement("div",null,r.createElement(K.Ay,{name:"suggestedProducts",isMulti:!0,value:e.filter((e=>this.props.suggestedParents.includes(e.value))),onChange:this.props.onSelectParent.bind(this,"suggestedParents"),options:e,isDisabled:this.props.isSaving}),this.buildErrors("suggested_parents")))))}}const V=gettext("User configurable bundles are bundles which link parent/standalone products to ranges of other products. Their intent is to represent a group of products related to the suggesting parent, rather than a specific one-to-one mapping of product to product.");class W extends r.PureComponent{getRangeSelectOptions(){return this.props.ranges.sort(((e,t)=>e.name.localeCompare(t.name))).map((e=>({value:e.id,label:e.name})))}getQuantitySelectOptions(){const e=[];for(let t=1;t<100;t++)e.push({value:t,label:`${t}`});return e}buildBundleRows(e){const t=this.getRangeSelectOptions(),n=this.getQuantitySelectOptions(),s=this.props.linkedRanges[e.id]||[];return(s.length<=0||null!==s[s.length-1].rangeID)&&s.push({rangeID:null,quantity:1}),r.createElement("table",{key:e.id,className:"table bundle-group-edit__link-table"},r.createElement("tbody",null,s.map(((s,i)=>r.createElement("tr",{key:i},r.createElement("th",null,r.createElement("a",{href:e.dashboard_url,target:"_blank",rel:"noreferrer"},e.title)),r.createElement("td",null,r.createElement(K.Ay,{isClearable:!0,value:t.filter((e=>e.value===s.rangeID)),options:t,onChange:this.props.onLinkedRangesChange.bind(this,e,i),isDisabled:this.props.isSaving})),r.createElement("td",null,r.createElement(K.Ay,{value:n.filter((e=>null!==s.rangeID&&e.value===s.quantity)),options:n,onChange:this.props.onLinkedRangeQuantityChange.bind(this,e,i),isDisabled:this.props.isSaving||null===s.rangeID})))))))}buildParentRows(){return this.props.triggeringParents.length<=0?r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-12"},r.createElement("p",null,r.createElement("em",null,gettext("Select at least one trigger product to begin linking ranges."))))):r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Trigger Parent")))),r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Suggested Range")))),r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Suggested Quantity")))),r.createElement("div",{className:"col-sm-12"},this.props.triggeringParents.map((e=>{const t=this.props.getProduct(e);return this.buildBundleRows(t)}))))}render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Range Links (User Configurable Bundles)")),r.createElement("p",null,r.createElement("em",null,V)),this.buildParentRows())}}class J extends r.PureComponent{getChildProductSelectOptions(e){return this.props.products.filter((t=>!t.is_parent&&(t.id===e.id||t.parent===e.id))).sort(((e,t)=>e.title.localeCompare(t.title))).map((e=>({value:e.id,label:e.title})))}buildBundleRows(e,t){const n=this.props.products.filter((t=>!t.is_parent&&(t.id===e.id||t.parent===e.id))).sort(((e,t)=>e.title.localeCompare(t.title))),s=this.getChildProductSelectOptions(t);return r.createElement("table",{className:"table bundle-group-edit__link-table"},r.createElement("tbody",null,n.map((e=>{const n=(this.props.linkedProducts[e.id]||[]).filter((e=>{const n=this.props.getProduct(e);return n.id===t.id||n.parent===t.id}));return r.createElement("tr",{key:e.id},r.createElement("th",null,r.createElement("a",{href:e.dashboard_url,target:"_blank",rel:"noreferrer"},e.title)),r.createElement("td",null,r.createElement(K.Ay,{isMulti:!0,value:s.filter((e=>n.includes(e.value))),options:s,onChange:this.props.onLinkedProductsChange.bind(this,e,t),isDisabled:this.props.isSaving})))}))))}buildParentRows(){if(this.props.triggeringParents.length<=0||this.props.suggestedParents.length<=0)return r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-12"},r.createElement("p",null,r.createElement("em",null,gettext("Select at least one trigger product and one suggested product to begin linking variants.")))));const e={};return this.props.triggeringParents.forEach((t=>{this.props.suggestedParents.forEach((n=>{e[`${t}-${n}`]={triggerParent:this.props.getProduct(t),suggestParent:this.props.getProduct(n)}}))})),Object.values(e).map(((e,t)=>r.createElement("div",{key:t,className:"row"},r.createElement("div",{className:"col-sm-6"},r.createElement("h3",null,r.createElement("strong",null,e.triggerParent.title)," ",r.createElement("em",null,gettext("(Trigger Parent)")))),r.createElement("div",{className:"col-sm-6"},r.createElement("h3",null,r.createElement("strong",null,e.suggestParent.title)," ",r.createElement("em",null,gettext("(Suggestion Parent)")))),r.createElement("div",{className:"col-sm-12"},this.buildBundleRows(e.triggerParent,e.suggestParent)))))}render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Product Links (Concrete Bundles)")),r.createElement("p",null,r.createElement("em",null,gettext("Concrete bundles are bundles which link products to other specific products. They can not be customized by the end-consumer."))),this.buildParentRows())}}class X extends r.PureComponent{render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("div",{className:"form-group"},r.createElement("a",{className:"btn btn-secondary",onClick:this.props.onCancel},gettext("Cancel"))," ",r.createElement("button",{className:"btn btn-primary",type:"submit"},gettext("Save"))))}}const ee=e=>!!e&&void 0!==e.length,te=e=>!!e&&!ee(e);class ne extends r.PureComponent{constructor(e){super(e),this.onEdit=e=>{const t=e.currentTarget.name,n=e.currentTarget.value;this.setState((e=>Object.assign(Object.assign({},e),{[t]:n})))},this.onSelectImage=e=>{if(!e.currentTarget.files)return;const t=e.currentTarget.files[0];this.setState({image:t})},this.onSelectParent=(e,t)=>{let n;n=t?void 0===t.length?[t]:t:[],this.setState((t=>Object.assign(Object.assign({},t),{[e]:n.map((e=>e.value))})))},this.onLinkedRangesChange=(e,t,n)=>{let r=null;if(te(n))r=n;else if(ee(n))throw new Error("Can not link multiple ranges to a single trigger parent");this.setState((n=>{const s=Object.assign({},n.linkedRanges);return r?(s[e.id]||(s[e.id]=[]),s[e.id][t]=Object.assign(Object.assign({},s[e.id][t]||{}),{rangeID:r.value,quantity:1})):(delete s[e.id][t],s[e.id]=s[e.id].filter((e=>!!e)),s[e.id].length<=0&&delete s[e.id]),Object.assign(Object.assign({},n),{linkedRanges:s})}))},this.onLinkedRangesQuantityChange=(e,t,n)=>{let r={value:1,label:"1"};if(te(n))r=n;else if(ee(n))throw new Error("Can not link multiple quantities to a single range parent");this.setState((n=>{const s=Object.assign({},n.linkedRanges);return s[e.id]&&s[e.id][t]&&(s[e.id][t]=Object.assign(Object.assign({},s[e.id][t]),{quantity:r.value})),Object.assign(Object.assign({},n),{linkedRanges:s})}))},this.onLinkedProductsChange=(e,t,n)=>{let r;r=n?te(n)?[n]:n:[];const s=r.map((e=>e.value));this.setState((n=>{const r=(n.linkedProducts[e.id]||[]).filter((e=>{const n=this.getProduct(e);return n.id!==t.id&&n.parent!==t.id})).concat(s).filter(((e,t,n)=>n.indexOf(e)===t)),i=Object.assign(Object.assign({},n.linkedProducts),{[e.id]:r});return Object.assign(Object.assign({},n),{linkedProducts:i})}))},this.onCancel=e=>{e.preventDefault(),this.props.onCancel()},this.onSave=e=>{e.preventDefault();const t={id:this.props.group?this.props.group.id:null,bundle_type:this.state.bundleType,name:this.state.name,description:this.state.description,headline:this.state.headline,is_active:this.state.isActive,image:this.props.group?this.props.group.image:"",newImage:this.state.clearImage?null:this.state.image,clearImage:this.state.clearImage,triggering_parents:this.state.triggeringParents,suggested_parents:this.state.suggestedParents,concrete_bundles:[],user_configurable_bundles:[]};Object.keys(this.state.linkedRanges).forEach((e=>{const n=parseInt(e,10),r=this.getProduct(n);(-1!==t.triggering_parents.indexOf(r.id)||r.parent&&-1!==t.triggering_parents.indexOf(r.parent))&&this.state.linkedRanges[n].forEach((e=>{let r,{rangeID:s,quantity:i}=e;s&&i&&(this.props.group&&(r=this.props.group.user_configurable_bundles.find((e=>e.triggering_product===n&&e.suggested_range===s))),t.user_configurable_bundles.push({id:r?r.id:null,triggering_product:n,suggested_range:s,quantity:i}))}))})),Object.keys(this.state.linkedProducts).forEach((e=>{const n=parseInt(e,10),r=this.getProduct(n);if(-1===t.triggering_parents.indexOf(r.id)&&(!r.parent||-1===t.triggering_parents.indexOf(r.parent)))return;let s;this.props.group&&(s=this.props.group.concrete_bundles.find((e=>e.triggering_product===n)));const i=this.state.linkedProducts[n].filter((e=>{const n=this.getProduct(e);return-1!==t.suggested_parents.indexOf(n.id)||n.parent&&-1!==t.suggested_parents.indexOf(n.parent)}));i.length<=0||t.concrete_bundles.push({id:s?s.id:null,triggering_product:n,suggested_products:i})})),this.props.onSave(t)},this.onClearImage=e=>{this.setState({clearImage:e.currentTarget.checked})},this.getProduct=e=>this.productIdx[e];const t={};(e.group?e.group.user_configurable_bundles:[]).forEach((e=>{t[e.triggering_product]||(t[e.triggering_product]=[]),t[e.triggering_product].push({rangeID:e.suggested_range,quantity:e.quantity})}));const n={};(e.group?e.group.concrete_bundles:[]).forEach((e=>{n[e.triggering_product]||(n[e.triggering_product]=[]),n[e.triggering_product]=n[e.triggering_product].concat(e.suggested_products).filter(((e,t,n)=>n.indexOf(e)===t))}));const r={bundleType:"",name:"",description:"",headline:"",isActive:!0,image:null,clearImage:!1,triggeringParents:[],suggestedParents:[],linkedRanges:t,linkedProducts:n};e.group?(r.bundleType=e.group.bundle_type,r.name=e.group.name,r.description=e.group.description,r.headline=e.group.headline,r.isActive=e.group.is_active,r.triggeringParents=e.group.triggering_parents,r.suggestedParents=e.group.suggested_parents):e.bundleTypeChoices.length>0&&(r.bundleType=e.bundleTypeChoices[0].value),this.state=r,this.productIdx={},this.fillProductIdx(e.products)}UNSAFE_componentWillReceiveProps(e){this.fillProductIdx(e.products)}fillProductIdx(e){this.productIdx={},e.forEach((e=>{this.productIdx[e.id]=e}))}render(){return r.createElement("form",{className:"row bundle-group-edit",onSubmit:this.onSave},r.createElement(z,{bundleTypeChoices:this.props.bundleTypeChoices,group:this.props.group,isSaving:this.props.isSaving,errors:this.props.errors,bundleType:this.state.bundleType,name:this.state.name,headline:this.state.headline,description:this.state.description,isActive:this.state.isActive||!1,image:this.state.image,clearImage:this.state.clearImage,onEdit:this.onEdit,onSelectImage:this.onSelectImage,onClearImage:this.onClearImage}),r.createElement(Z,{products:this.props.products,isSaving:this.props.isSaving,errors:this.props.errors,triggeringParents:this.state.triggeringParents,suggestedParents:this.state.suggestedParents,onSelectParent:this.onSelectParent}),r.createElement(W,{ranges:this.props.ranges,isSaving:this.props.isSaving,triggeringParents:this.state.triggeringParents,linkedRanges:this.state.linkedRanges,getProduct:this.getProduct,onLinkedRangesChange:this.onLinkedRangesChange,onLinkedRangeQuantityChange:this.onLinkedRangesQuantityChange}),r.createElement(J,{products:this.props.products,isSaving:this.props.isSaving,triggeringParents:this.state.triggeringParents,suggestedParents:this.state.suggestedParents,linkedProducts:this.state.linkedProducts,getProduct:this.getProduct,onLinkedProductsChange:this.onLinkedProductsChange}),r.createElement(X,{onCancel:this.onCancel}))}}var re=ne;class se extends r.PureComponent{buildGroupActions(){return r.createElement("div",{className:"btn-toolbar"},r.createElement("div",{className:"dropdown"},r.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},gettext("Actions")," ",r.createElement("span",{className:"caret"})),r.createElement("ul",{className:"dropdown-menu dropdown-menu-right"},r.createElement("a",{className:"dropdown-item",onClick:e=>{e.preventDefault(),this.props.onEdit(this.props.group)}},gettext("Edit")),r.createElement("a",{className:"dropdown-item",onClick:e=>{e.preventDefault();const t=gettext("Are you sure you want to delete this bundle group (%(name)s) and all its associated bundles?"),n={name:this.props.group.name},r=interpolate(t,n,!0);confirm(r)&&this.props.onDelete(this.props.group)}},gettext("Delete")))))}buildProductList(e){const t=this.props.products.filter((t=>-1!==e.indexOf(t.id)));return r.createElement("ul",null,t.map((e=>r.createElement("li",{key:e.id},r.createElement("a",{href:e.dashboard_url},e.title)))))}buildRangeList(){const e=this.props.group.user_configurable_bundles.map((e=>e.suggested_range)),t=this.props.ranges.filter((t=>e.includes(t.id)));return r.createElement("ul",null,t.map((e=>r.createElement("li",{key:e.id},r.createElement("a",{href:e.dashboard_url},e.name)))))}render(){const e=this.props.bundleTypeChoices.find((e=>e.value===this.props.group.bundle_type));let t=null,n=null;return this.props.group.suggested_parents&&(t=r.createElement(r.Fragment,null,r.createElement("em",null,gettext("Products:")),this.buildProductList(this.props.group.suggested_parents))),this.props.group.user_configurable_bundles.length>0&&(n=r.createElement(r.Fragment,null,r.createElement("em",null,gettext("Ranges:")),this.buildRangeList())),r.createElement("tr",{key:`${this.props.group.id}`},r.createElement("td",null,this.props.group.name),r.createElement("td",null,e?e.display_name:""),r.createElement("td",null,r.createElement("img",{src:this.props.group.image||void 0,width:100})),r.createElement("td",null,this.buildProductList(this.props.group.triggering_parents)),r.createElement("td",null,t,n),r.createElement("td",null,this.props.group.is_active?gettext("Active"):gettext("Inactive")),r.createElement("td",null,this.buildGroupActions()))}}var ie=se;c().setAppElement("#bundlegroup-table");const ae={overlay:{backgroundColor:"rgba(51, 51, 51, 0.8)",zIndex:2e3},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",minWidth:"800px",maxWidth:"1000px",maxHeight:"90%"}};class le extends r.Component{constructor(){super(...arguments),this.state={bundleTypeChoices:[],groups:[],products:[],ranges:[],searchText:"",selectedGroup:null,editModalOpen:!1,isSaving:!1,isLoading:!0,formErrors:{}},this.onSearchTextChange=e=>{this.setState({searchText:e})},this.onCreate=e=>{e.preventDefault(),this.openCreateModal()},this.onOpenEditModal=e=>{this.setState({selectedGroup:e.id,formErrors:{},editModalOpen:!0})},this.onCloseModal=()=>{this.setState({selectedGroup:null,formErrors:{},editModalOpen:!1})},this.onSaveBundleGroup=e=>(0,i.sH)(this,void 0,void 0,(function*(){this.setState({isSaving:!0});try{yield((e,t)=>(0,i.sH)(void 0,void 0,void 0,(function*(){const n=yield((e,t)=>(0,i.sH)(void 0,void 0,void 0,(function*(){const[n,r]=t.id?["PATCH",`${e}${t.id}/`]:["POST",e],s=Object.assign({},t);delete s.image,delete s.newImage,delete s.clearImage;const i=yield fetch(r,{method:n,headers:{Accept:"application/json","Content-Type":"application/json",[Y]:G()},body:JSON.stringify(s)});return h(L.decode(yield i.json()))})))(e,t);return t.id=n.id,yield((e,t)=>(0,i.sH)(void 0,void 0,void 0,(function*(){if(!t.id)throw new Error("Can not save image for unsaved bundle group");if(!t.newImage&&!t.clearImage)return Promise.resolve();if(t.newImage&&!t.clearImage){const n=new FormData;return n.append("image",t.newImage,t.newImage.name),void(yield fetch(`${e}${t.id}/`,{method:"PATCH",headers:{Accept:"application/json",[Y]:G()},body:n}))}t.clearImage&&(yield fetch(`${e}${t.id}/`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json",[Y]:G()},body:JSON.stringify({image:null})}))})))(e,t),n})))(this.props.bundleGroupURL,e),yield this.loadData(),this.setState({isSaving:!1}),this.onCloseModal()}catch(e){this.setState({isSaving:!1,formErrors:e.response.body})}})),this.onDeleteBundleGroup=e=>(0,i.sH)(this,void 0,void 0,(function*(){var t,n;return yield(t=this.props.bundleGroupURL,n=e,(0,i.sH)(void 0,void 0,void 0,(function*(){if(!n.id)throw new Error("Can not delete unsaved bundle group");yield fetch(`${t}${n.id}/`,{method:"DELETE",headers:{Accept:"application/json",[Y]:G()}})}))),this.loadData()}))}componentDidMount(){this.loadData().catch((e=>{console.error(e)}))}loadData(){return(0,i.sH)(this,void 0,void 0,(function*(){this.setState({isLoading:!0});const e=Promise.all([(t=this.props.bundleGroupURL,(0,i.sH)(void 0,void 0,void 0,(function*(){const e=yield fetch(t,{method:"OPTIONS",headers:{Accept:"application/json"}}),n=h(j.decode(yield e.json()));return n.actions.POST?h(O.decode(n.actions.POST.bundle_type)).choices:[]}))),F(this.props.bundleGroupURL),q(this.props.concreteBundleProductChoiceURL),B(this.props.userConfigurableBundleRangeChoiceURL)]);var t;const[n,r,s,a]=yield e;this.setBundleTypeChoices(n),this.setGroups(r),this.setProducts(s),this.setRanges(a),this.setState({isLoading:!1})}))}openCreateModal(){this.setState({selectedGroup:null,formErrors:{},editModalOpen:!0})}setGroups(e){this.idx=l()((function(){this.ref("id"),this.field("name"),this.field("description"),e.forEach((e=>{this.add(e)}))})),this.setState({groups:e})}setBundleTypeChoices(e){this.setState({bundleTypeChoices:e})}setProducts(e){this.setState({products:e})}setRanges(e){this.setState({ranges:e})}getSearchResults(e){return this.idx?this.idx.search(e).map((e=>{const t=parseInt(e.ref,10);return this.state.groups.find((e=>e.id===t))})).filter((e=>!!e)):[]}buildGroupRows(){const e=this.state.searchText.trim(),t=e?this.getSearchResults(e):this.state.groups;if(this.state.isLoading)return r.createElement("tr",null,r.createElement("td",{colSpan:6},r.createElement("em",null,gettext("Loadingâ€¦"))));if(t.length<=0){const t=e?interpolate(gettext("No bundle groups found for search: %(searchText)s"),{searchText:e},!0):gettext("No bundle groups found.");return r.createElement("tr",null,r.createElement("td",{colSpan:6},t))}return t.map((e=>r.createElement(ie,{key:`${e.id}`,bundleTypeChoices:this.state.bundleTypeChoices,group:e,products:this.state.products,ranges:this.state.ranges,onEdit:this.onOpenEditModal,onDelete:e=>{this.onDeleteBundleGroup(e).catch((e=>{console.error(e)}))}})))}buildEditModal(){const e=this.state.groups.find((e=>e.id===this.state.selectedGroup));return r.createElement(c(),{contentLabel:gettext("Edit Bundle Group"),style:ae,isOpen:this.state.editModalOpen},r.createElement(re,{bundleTypeChoices:this.state.bundleTypeChoices,group:e||null,products:this.state.products,ranges:this.state.ranges,isSaving:this.state.isSaving,errors:this.state.formErrors,onCancel:this.onCloseModal,onSave:e=>{this.onSaveBundleGroup(e).catch((e=>{console.error(e)}))}}))}render(){return r.createElement("div",null,r.createElement("div",{className:"page-header"},r.createElement("a",{className:"btn btn-primary float-right",onClick:this.onCreate},r.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Create new bundle group")),r.createElement("h1",null,gettext("Bundle Groups"))),r.createElement("div",{className:"table-header"},r.createElement("h3",null,r.createElement("i",{className:"fas fa-search"}),gettext("Search Bundle Groups"))),r.createElement(U,{searchText:this.state.searchText,onChange:this.onSearchTextChange}),r.createElement("table",{className:"table table-striped table-bordered"},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("th",null,gettext("Name")),r.createElement("th",null,gettext("Type")),r.createElement("th",null,gettext("Image")),r.createElement("th",null,gettext("Triggers")),r.createElement("th",null,gettext("Suggestions")),r.createElement("th",null,gettext("Active Status")),r.createElement("th",null,gettext("Actions"))),this.buildGroupRows())),this.buildEditModal())}}var oe=le;!function(){const e=document.querySelector("#bundlegroup-table"),t=e.dataset.bundlegroupApi||"",n=e.dataset.concretebundleApi||"",i=e.dataset.concretebundleProductChoiceApi||"",a=e.dataset.userconfigurablebundleApi||"",l=e.dataset.userconfigurablebundleRangeChoiceApi||"";(0,s.H)(e).render(r.createElement(oe,{bundleGroupURL:t,concreteBundleURL:n,concreteBundleProductChoiceURL:i,userConfigurableBundleURL:a,userConfigurableBundleRangeChoiceURL:l}))}()}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return r[e].call(n.exports,n,n.exports,i),n.exports}i.m=r,e=[],i.O=function(t,n,r,s){if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],s=e[d][2];for(var l=!0,o=0;o<n.length;o++)(!1&s||a>=s)&&Object.keys(i.O).every((function(e){return i.O[e](n[o])}))?n.splice(o--,1):(l=!1,s<a&&(a=s));if(l){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,r,s]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},n=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},i.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var s=Object.create(null);i.r(s);var a={};t=t||[null,n({}),n([]),n(n)];for(var l=2&r&&e;"object"==typeof l&&!~t.indexOf(l);l=n(l))Object.getOwnPropertyNames(l).forEach((function(t){a[t]=function(){return e[t]}}));return a.default=function(){return e},i.d(s,a),s},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={582:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,s,a=n[0],l=n[1],o=n[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(r in l)i.o(l,r)&&(i.m[r]=l[r]);if(o)var d=o(i)}for(t&&t(n);c<a.length;c++)s=a[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},n=self.webpackChunkdjango_oscar_bundles=self.webpackChunkdjango_oscar_bundles||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=i.O(void 0,[121],(function(){return i(376)}));a=i.O(a)}();
//# sourceMappingURL=bundles.js.map
