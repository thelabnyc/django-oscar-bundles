!function(){"use strict";var e={2031:function(e,t,n){n(3792),n(9244),n(7727),n(5306),n(4197),n(6495),n(7145),n(5109),n(5125),n(2472),n(9743),n(8255),n(9135),n(8145),n(5206),n(3948),n(4633),n(285),n(3753),n(1637);var r=n(7015),s=n(6031),a=n(3616),i=n(4432),l=n.n(i),o=n(221),c=n.n(o),d=n(5637),u=n.n(d),p=n(2589),g=n.n(p),h=n(9553),m=n(139),b=n(1570);const E=e=>{if((0,b.isLeft)(e))throw new Error((0,m.Rn)(e.left).join("\n"));return e.right},f=e=>h.G0([h.lB,e]),v=e=>h.G0([h.S1,e]);class _ extends h.Dy{constructor(){super("number",(e=>e instanceof File),((e,t)=>this.is(e)?h.Vp(e):h.Rn(e,t)),h.yR),this._tag="NumberType"}}const y=new _,P=h.w3({value:h.Z_,display_name:h.Z_}),C=h.Bk(P),x=e=>h.w3({type:e,required:h.O7,read_only:h.O7,label:h.Z_,help_text:v(h.Z_)}),S=x(h.i0("integer")),k=x(h.i0("boolean")),N=x(h.i0("datetime")),I=h.jV([x(h.i0("string")),h.w3({max_length:v(h.pk)})]),T=h.jV([x(h.i0("choice")),h.w3({choices:C})]),w=h.G0([S,k,N,I,T,h._4]),O=(h.G0([h.i0("GET"),h.i0("HEAD"),h.i0("OPTIONS"),h.i0("POST"),h.i0("PUT"),h.i0("PATCH"),h.i0("DELETE")]),h.w3({name:h.Z_,description:h.Z_,renders:h.Bk(h.Z_),parses:h.Bk(h.Z_),actions:h.w3({GET:v(h.IM(h.Z_,w)),HEAD:v(h.IM(h.Z_,w)),OPTIONS:v(h.IM(h.Z_,w)),POST:v(h.IM(h.Z_,w)),PUT:v(h.IM(h.Z_,w)),PATCH:v(h.IM(h.Z_,w)),DELETE:v(h.IM(h.Z_,w))})})),R=h.w3({id:h.pk,dashboard_url:h.Z_,product_class:f(h.w3({id:h.pk,name:h.Z_})),title:h.Z_,slug:h.Z_,is_parent:h.O7,is_child:h.O7,parent:f(h.pk),children:h.IX(h.pk)}),G=h.IX(R),L=h.w3({id:h.pk,dashboard_url:h.Z_,name:h.Z_,slug:h.Z_,description:h.Z_}),j=h.IX(L),D=h.w3({id:f(h.pk),triggering_product:h.pk,suggested_products:h.IX(h.pk)}),Z=(h.IX(D),h.w3({id:f(h.pk),triggering_product:h.pk,suggested_range:h.pk,quantity:h.pk})),B=(h.IX(Z),h.w3({id:f(h.pk),bundle_type:h.Z_,name:h.Z_,description:h.Z_,headline:h.Z_,image:v(f(h.Z_)),newImage:v(f(y)),clearImage:v(h.O7),triggering_parents:h.IX(h.pk),suggested_parents:h.IX(h.pk),concrete_bundles:h.IX(D),user_configurable_bundles:h.IX(Z)})),M=h.IX(B),F="X-CSRFToken",A=function(){return g().get("csrftoken")||""},U=e=>(0,a.mG)(void 0,void 0,void 0,(function*(){return u().get(e).set("Accept","application/json")})),q=e=>(0,a.mG)(void 0,void 0,void 0,(function*(){const t=yield U(e);return E(M.decode(t.body))})),X=e=>(0,a.mG)(void 0,void 0,void 0,(function*(){const t=yield U(e);return E(G.decode(t.body))})),Q=e=>(0,a.mG)(void 0,void 0,void 0,(function*(){const t=yield U(e);return E(j.decode(t.body))}));class H extends r.PureComponent{render(){const e=this;return r.createElement("div",{className:"card card-body bg-light"},r.createElement("form",{className:"form-inline",onSubmit:function(e){e.preventDefault()}},r.createElement("span",{className:"form-group"},r.createElement("label",{htmlFor:"id_text"},gettext("Search:")),r.createElement("input",{className:"form-control",id:"id_text",value:this.props.searchText,onChange:function(t){t.preventDefault(),e.props.onChange(t.currentTarget.value)}}))," ",r.createElement("button",{type:"button",className:"btn btn-secondary",onClick:function(t){t.preventDefault(),e.props.onChange("")}},gettext("Clear Search"))))}}var V=H,W=n(3932),z=n.n(W);class J extends r.PureComponent{buildFormGroupClasses(e){const t=this.props.errors[e],n={"form-group":!0,"has-error":!!t&&t.length>0};return z()(n)}buildErrors(e){return(this.props.errors[e]||[]).map(((e,t)=>r.createElement("span",{key:t,className:"help-block"},r.createElement("i",{className:"fas fa-exclamation"})," ",e)))}buildCurrentImage(){if(!this.props.group||!this.props.group.image)return null;const e=this.props.group.image.split("/"),t=e[e.length-1];return r.createElement("span",null,gettext("Currently:")," ",r.createElement("a",{target:"_blank",href:this.props.group.image},t)," ",r.createElement("input",{type:"checkbox",id:"bundle-edit-form-clear-img",checked:this.props.clearImage,onChange:this.props.onClearImage,disabled:this.props.isSaving})," ",r.createElement("label",{htmlFor:"bundle-edit-form-clear-img"},gettext("Clear")))}render(){const e=this.props.group?gettext("Edit Bundle Group"):gettext("Create Bundle Group");return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,e),r.createElement("div",{className:this.buildFormGroupClasses("bundleType")},r.createElement("label",{htmlFor:"id_bundleType",className:"control-label"},gettext("Bundle Type")),r.createElement("div",null,r.createElement("select",{id:"id_bundleType",name:"bundleType",className:"form-control",value:this.props.bundleType,onChange:this.props.onEdit,disabled:this.props.isSaving},this.props.bundleTypeChoices.map((e=>r.createElement("option",{key:e.value,value:e.value},e.display_name)))),this.buildErrors("bundleType"))),r.createElement("div",{className:this.buildFormGroupClasses("name")},r.createElement("label",{htmlFor:"id_name",className:"control-label"},gettext("Name")),r.createElement("div",null,r.createElement("input",{id:"id_name",name:"name",maxLength:200,className:"form-control",value:this.props.name,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("name"))),r.createElement("div",{className:this.buildFormGroupClasses("headline")},r.createElement("label",{htmlFor:"id_headline",className:"control-label"},gettext("Headline")),r.createElement("div",null,r.createElement("textarea",{id:"id_headline",name:"headline",cols:40,rows:4,className:"form-control",value:this.props.headline,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("headline"))),r.createElement("div",{className:this.buildFormGroupClasses("description")},r.createElement("label",{htmlFor:"id_description",className:"control-label"},gettext("Description")),r.createElement("div",null,r.createElement("textarea",{id:"id_description",name:"description",cols:40,rows:4,className:"form-control",value:this.props.description,onChange:this.props.onEdit,disabled:this.props.isSaving}),this.buildErrors("description"))),r.createElement("div",{className:this.buildFormGroupClasses("image")},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Image")),r.createElement("div",null,this.buildCurrentImage(),r.createElement("input",{id:"id_image",type:"file",name:"image",className:"form-control",onChange:this.props.onSelectImage,disabled:this.props.isSaving}),this.buildErrors("image"))))}}var K=n(4330);class Y extends r.PureComponent{getParentProductSelectOptions(){return this.props.products.filter((e=>!e.is_child)).sort(((e,t)=>e.title.localeCompare(t.title))).map((e=>({value:e.id,label:e.title})))}buildFormGroupClasses(e,t){const n=this.props.errors[e],r={"form-group":!0,"has-error":!!n&&n.length>0};return t.forEach((e=>{r[e]=!0})),z()(r)}buildErrors(e){return(this.props.errors[e]||[]).map(((e,t)=>r.createElement("span",{key:t,className:"help-block"},r.createElement("i",{className:"fas fa-exclamation"})," ",e)))}render(){const e=this.getParentProductSelectOptions();return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Relevant Products")),r.createElement("p",null,r.createElement("em",null,gettext("Select the parent and standalone products revelant to this bundle group."))),r.createElement("div",{className:"row"},r.createElement("div",{className:this.buildFormGroupClasses("triggering_parents",["col-sm-6"])},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Triggers")),r.createElement("div",null,r.createElement(K.ZP,{name:"triggeringParents",isMulti:!0,value:e.filter((e=>this.props.triggeringParents.includes(e.value))),onChange:this.props.onSelectParent.bind(this,"triggeringParents"),options:e,isDisabled:this.props.isSaving}),this.buildErrors("triggering_parents"))),r.createElement("div",{className:this.buildFormGroupClasses("suggested_parents",["col-sm-6"])},r.createElement("label",{htmlFor:"id_image",className:"control-label"},gettext("Suggestions")),r.createElement("div",null,r.createElement(K.ZP,{name:"suggestedProducts",isMulti:!0,value:e.filter((e=>this.props.suggestedParents.includes(e.value))),onChange:this.props.onSelectParent.bind(this,"suggestedParents"),options:e,isDisabled:this.props.isSaving}),this.buildErrors("suggested_parents")))))}}const $=gettext("User configurable bundles are bundles which link parent/standalone products to ranges of other products. Their intent is to represent a group of products related to the suggesting parent, rather than a specific one-to-one mapping of product to product.");class ee extends r.PureComponent{getRangeSelectOptions(){return this.props.ranges.sort(((e,t)=>e.name.localeCompare(t.name))).map((e=>({value:e.id,label:e.name})))}getQuantitySelectOptions(){const e=[];for(let t=1;t<100;t++)e.push({value:t,label:"".concat(t)});return e}buildBundleRows(e){const t=this.getRangeSelectOptions(),n=this.getQuantitySelectOptions(),s=this.props.linkedRanges[e.id]||[];return(s.length<=0||null!==s[s.length-1].rangeID)&&s.push({rangeID:null,quantity:1}),r.createElement("table",{key:e.id,className:"table bundle-group-edit__link-table"},r.createElement("tbody",null,s.map(((s,a)=>r.createElement("tr",{key:a},r.createElement("th",null,r.createElement("a",{href:e.dashboard_url,target:"_blank"},e.title)),r.createElement("td",null,r.createElement(K.ZP,{isClearable:!0,value:t.filter((e=>e.value===s.rangeID)),options:t,onChange:this.props.onLinkedRangesChange.bind(this,e,a),isDisabled:this.props.isSaving})),r.createElement("td",null,r.createElement(K.ZP,{value:n.filter((e=>null!==s.rangeID&&e.value===s.quantity)),options:n,onChange:this.props.onLinkedRangeQuantityChange.bind(this,e,a),isDisabled:this.props.isSaving||null===s.rangeID})))))))}buildParentRows(){return this.props.triggeringParents.length<=0?r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-12"},r.createElement("p",null,r.createElement("em",null,gettext("Select at least one trigger product to begin linking ranges."))))):r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Trigger Parent")))),r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Suggested Range")))),r.createElement("div",{className:"col-sm-4"},r.createElement("h3",null,r.createElement("strong",null,gettext("Suggested Quantity")))),r.createElement("div",{className:"col-sm-12"},this.props.triggeringParents.map((e=>{const t=this.props.getProduct(e);return this.buildBundleRows(t)}))))}render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Range Links (User Configurable Bundles)")),r.createElement("p",null,r.createElement("em",null,$)),this.buildParentRows())}}class te extends r.PureComponent{getChildProductSelectOptions(e){return this.props.products.filter((t=>!t.is_parent&&(t.id===e.id||t.parent===e.id))).sort(((e,t)=>e.title.localeCompare(t.title))).map((e=>({value:e.id,label:e.title})))}buildBundleRows(e,t){const n=this.props.products.filter((t=>!t.is_parent&&(t.id===e.id||t.parent===e.id))).sort(((e,t)=>e.title.localeCompare(t.title))),s=this.getChildProductSelectOptions(t);return r.createElement("table",{className:"table bundle-group-edit__link-table"},r.createElement("tbody",null,n.map((e=>{const n=(this.props.linkedProducts[e.id]||[]).filter((e=>{const n=this.props.getProduct(e);return n.id===t.id||n.parent===t.id}));return r.createElement("tr",{key:e.id},r.createElement("th",null,r.createElement("a",{href:e.dashboard_url,target:"_blank"},e.title)),r.createElement("td",null,r.createElement(K.ZP,{isMulti:!0,value:s.filter((e=>n.includes(e.value))),options:s,onChange:this.props.onLinkedProductsChange.bind(this,e,t),isDisabled:this.props.isSaving})))}))))}buildParentRows(){if(this.props.triggeringParents.length<=0||this.props.suggestedParents.length<=0)return r.createElement("div",{className:"row"},r.createElement("div",{className:"col-sm-12"},r.createElement("p",null,r.createElement("em",null,gettext("Select at least one trigger product and one suggested product to begin linking variants.")))));const e={};return this.props.triggeringParents.forEach((t=>{this.props.suggestedParents.forEach((n=>{const r=(s=n,"".concat(t,"-").concat(s));var s;e[r]={triggerParent:this.props.getProduct(t),suggestParent:this.props.getProduct(n)}}))})),Object.values(e).map(((e,t)=>r.createElement("div",{key:t,className:"row"},r.createElement("div",{className:"col-sm-6"},r.createElement("h3",null,r.createElement("strong",null,e.triggerParent.title)," ",r.createElement("em",null,gettext("(Trigger Parent)")))),r.createElement("div",{className:"col-sm-6"},r.createElement("h3",null,r.createElement("strong",null,e.suggestParent.title)," ",r.createElement("em",null,gettext("(Suggestion Parent)")))),r.createElement("div",{className:"col-sm-12"},this.buildBundleRows(e.triggerParent,e.suggestParent)))))}render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("h1",null,gettext("Product Links (Concrete Bundles)")),r.createElement("p",null,r.createElement("em",null,gettext("Concrete bundles are bundles which link products to other specific products. They can not be customized by the end-consumer."))),this.buildParentRows())}}class ne extends r.PureComponent{render(){return r.createElement("div",{className:"col-sm-12 bundle-group-edit__section"},r.createElement("div",{className:"form-group"},r.createElement("a",{className:"btn btn-secondary",onClick:this.props.onCancel},gettext("Cancel"))," ",r.createElement("button",{className:"btn btn-primary",type:"submit"},gettext("Save"))))}}const re=e=>!!e&&void 0!==e.length,se=e=>!!e&&!re(e);class ae extends r.PureComponent{constructor(e){super(e),this.onEdit=e=>{const t=e.currentTarget.name,n=e.currentTarget.value;this.setState((e=>Object.assign(Object.assign({},e),{[t]:n})))},this.onSelectImage=e=>{if(!e.currentTarget.files)return;const t=e.currentTarget.files[0];this.setState({image:t})},this.onSelectParent=(e,t)=>{let n;n=t?void 0===t.length?[t]:t:[],this.setState((t=>Object.assign(Object.assign({},t),{[e]:n.map((e=>e.value))})))},this.onLinkedRangesChange=(e,t,n)=>{let r=null;if(se(n))r=n;else if(re(n))throw new Error("Can not link multiple ranges to a single trigger parent");this.setState((n=>{const s=Object.assign({},n.linkedRanges);return r?(s[e.id]||(s[e.id]=[]),s[e.id][t]=Object.assign(Object.assign({},s[e.id][t]||{}),{rangeID:r.value,quantity:1})):(delete s[e.id][t],s[e.id]=s[e.id].filter((e=>!!e)),s[e.id].length<=0&&delete s[e.id]),Object.assign(Object.assign({},n),{linkedRanges:s})}))},this.onLinkedRangesQuantityChange=(e,t,n)=>{let r={value:1,label:"1"};if(se(n))r=n;else if(re(n))throw new Error("Can not link multiple quantities to a single range parent");this.setState((n=>{const s=Object.assign({},n.linkedRanges);return s[e.id]&&s[e.id][t]&&(s[e.id][t]=Object.assign(Object.assign({},s[e.id][t]),{quantity:r.value})),Object.assign(Object.assign({},n),{linkedRanges:s})}))},this.onLinkedProductsChange=(e,t,n)=>{let r;r=n?se(n)?[n]:n:[];const s=r.map((e=>e.value));this.setState((n=>{const r=(n.linkedProducts[e.id]||[]).filter((e=>{const n=this.getProduct(e);return n.id!==t.id&&n.parent!==t.id})).concat(s).filter(((e,t,n)=>n.indexOf(e)===t)),a=Object.assign(Object.assign({},n.linkedProducts),{[e.id]:r});return Object.assign(Object.assign({},n),{linkedProducts:a})}))},this.onCancel=e=>{e.preventDefault(),this.props.onCancel()},this.onSave=e=>{e.preventDefault();const t={id:this.props.group?this.props.group.id:null,bundle_type:this.state.bundleType,name:this.state.name,description:this.state.description,headline:this.state.headline,image:this.props.group?this.props.group.image:"",newImage:this.state.clearImage?null:this.state.image,clearImage:this.state.clearImage,triggering_parents:this.state.triggeringParents,suggested_parents:this.state.suggestedParents,concrete_bundles:[],user_configurable_bundles:[]};Object.keys(this.state.linkedRanges).forEach((e=>{const n=parseInt(e,10),r=this.getProduct(n);(-1!==t.triggering_parents.indexOf(r.id)||r.parent&&-1!==t.triggering_parents.indexOf(r.parent))&&this.state.linkedRanges[n].forEach((({rangeID:e,quantity:r})=>{if(!e||!r)return;let s;this.props.group&&(s=this.props.group.user_configurable_bundles.find((t=>t.triggering_product===n&&t.suggested_range===e))),t.user_configurable_bundles.push({id:s?s.id:null,triggering_product:n,suggested_range:e,quantity:r})}))})),Object.keys(this.state.linkedProducts).forEach((e=>{const n=parseInt(e,10),r=this.getProduct(n);if(-1===t.triggering_parents.indexOf(r.id)&&(!r.parent||-1===t.triggering_parents.indexOf(r.parent)))return;let s;this.props.group&&(s=this.props.group.concrete_bundles.find((e=>e.triggering_product===n)));const a=this.state.linkedProducts[n].filter((e=>{const n=this.getProduct(e);return-1!==t.suggested_parents.indexOf(n.id)||!n.parent||-1!==t.suggested_parents.indexOf(n.parent)}));a.length<=0||t.concrete_bundles.push({id:s?s.id:null,triggering_product:n,suggested_products:a})})),this.props.onSave(t)},this.onClearImage=e=>{this.setState({clearImage:e.currentTarget.checked})},this.getProduct=e=>this.productIdx[e];const t={};(e.group?e.group.user_configurable_bundles:[]).forEach((e=>{t[e.triggering_product]||(t[e.triggering_product]=[]),t[e.triggering_product].push({rangeID:e.suggested_range,quantity:e.quantity})}));const n={};(e.group?e.group.concrete_bundles:[]).forEach((e=>{n[e.triggering_product]||(n[e.triggering_product]=[]),n[e.triggering_product]=n[e.triggering_product].concat(e.suggested_products).filter(((e,t,n)=>n.indexOf(e)===t))}));const r={bundleType:"",name:"",description:"",headline:"",image:null,clearImage:!1,triggeringParents:[],suggestedParents:[],linkedRanges:t,linkedProducts:n};e.group?(r.bundleType=e.group.bundle_type,r.name=e.group.name,r.description=e.group.description,r.headline=e.group.headline,r.triggeringParents=e.group.triggering_parents,r.suggestedParents=e.group.suggested_parents):e.bundleTypeChoices.length>0&&(r.bundleType=e.bundleTypeChoices[0].value),this.state=r,this.productIdx={},this.fillProductIdx(e.products)}componentWillReceiveProps(e){this.fillProductIdx(e.products)}fillProductIdx(e){this.productIdx={},e.forEach((e=>{this.productIdx[e.id]=e}))}render(){return r.createElement("form",{className:"row bundle-group-edit",onSubmit:this.onSave},r.createElement(J,{bundleTypeChoices:this.props.bundleTypeChoices,group:this.props.group,isSaving:this.props.isSaving,errors:this.props.errors,bundleType:this.state.bundleType,name:this.state.name,headline:this.state.headline,description:this.state.description,image:this.state.image,clearImage:this.state.clearImage,onEdit:this.onEdit,onSelectImage:this.onSelectImage,onClearImage:this.onClearImage}),r.createElement(Y,{products:this.props.products,isSaving:this.props.isSaving,errors:this.props.errors,triggeringParents:this.state.triggeringParents,suggestedParents:this.state.suggestedParents,onSelectParent:this.onSelectParent}),r.createElement(ee,{ranges:this.props.ranges,isSaving:this.props.isSaving,triggeringParents:this.state.triggeringParents,linkedRanges:this.state.linkedRanges,getProduct:this.getProduct,onLinkedRangesChange:this.onLinkedRangesChange,onLinkedRangeQuantityChange:this.onLinkedRangesQuantityChange}),r.createElement(te,{products:this.props.products,isSaving:this.props.isSaving,triggeringParents:this.state.triggeringParents,suggestedParents:this.state.suggestedParents,linkedProducts:this.state.linkedProducts,getProduct:this.getProduct,onLinkedProductsChange:this.onLinkedProductsChange}),r.createElement(ne,{onCancel:this.onCancel}))}}var ie=ae;class le extends r.PureComponent{buildGroupActions(){const e=this;return r.createElement("div",{className:"btn-toolbar"},r.createElement("div",{className:"dropdown"},r.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},gettext("Actions")," ",r.createElement("span",{className:"caret"})),r.createElement("ul",{className:"dropdown-menu dropdown-menu-right"},r.createElement("a",{className:"dropdown-item",onClick:function(t){t.preventDefault(),e.props.onEdit(e.props.group)}},gettext("Edit")),r.createElement("a",{className:"dropdown-item",onClick:function(t){t.preventDefault();const n=gettext("Are you sure you want to delete this bundle group (%(name)s) and all its associated bundles?"),r={name:e.props.group.name},s=interpolate(n,r,!0);confirm(s)&&e.props.onDelete(e.props.group)}},gettext("Delete")))))}buildProductList(e){const t=this.props.products.filter((t=>-1!==e.indexOf(t.id)));return r.createElement("ul",null,t.map((e=>r.createElement("li",{key:e.id},r.createElement("a",{href:e.dashboard_url},e.title)))))}buildRangeList(){const e=this.props.group.user_configurable_bundles.map((e=>e.suggested_range)),t=this.props.ranges.filter((t=>e.includes(t.id)));return r.createElement("ul",null,t.map((e=>r.createElement("li",{key:e.id},r.createElement("a",{href:e.dashboard_url},e.name)))))}render(){const e=this,t=this.props.bundleTypeChoices.find((t=>t.value===e.props.group.bundle_type));let n=null,s=null;return this.props.group.suggested_parents&&(n=r.createElement(r.Fragment,null,r.createElement("em",null,gettext("Products:")),this.buildProductList(this.props.group.suggested_parents))),this.props.group.user_configurable_bundles.length>0&&(s=r.createElement(r.Fragment,null,r.createElement("em",null,gettext("Ranges:")),this.buildRangeList())),r.createElement("tr",{key:"".concat(this.props.group.id)},r.createElement("td",null,this.props.group.name),r.createElement("td",null,t?t.display_name:""),r.createElement("td",null,r.createElement("img",{src:this.props.group.image||void 0,width:100})),r.createElement("td",null,this.buildProductList(this.props.group.triggering_parents)),r.createElement("td",null,n,s),r.createElement("td",null,this.buildGroupActions()))}}var oe=le;c().setAppElement("#bundlegroup-table");const ce={overlay:{backgroundColor:"rgba(51, 51, 51, 0.8)",zIndex:2e3},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",minWidth:"800px",maxWidth:"1000px",maxHeight:"90%"}};class de extends r.Component{constructor(){super(...arguments),this.state={bundleTypeChoices:[],groups:[],products:[],ranges:[],searchText:"",selectedGroup:null,editModalOpen:!1,isSaving:!1,isLoading:!0,formErrors:{}},this.onSearchTextChange=e=>{this.setState({searchText:e})},this.onCreate=e=>{e.preventDefault(),this.openCreateModal()},this.onOpenEditModal=e=>{this.setState({selectedGroup:e.id,formErrors:{},editModalOpen:!0})},this.onCloseModal=()=>{this.setState({selectedGroup:null,formErrors:{},editModalOpen:!1})},this.onSaveBundleGroup=e=>(0,a.mG)(this,void 0,void 0,(function*(){this.setState({isSaving:!0});try{yield((e,t)=>(0,a.mG)(void 0,void 0,void 0,(function*(){const n=yield((e,t)=>(0,a.mG)(void 0,void 0,void 0,(function*(){const n=t.id?u().patch("".concat(e).concat(t.id,"/")):u().post(e),r=Object.assign({},t);delete r.image,delete r.newImage,delete r.clearImage;const s=yield n.set("Accept","application/json").set(F,A()).send(r);return E(B.decode(s.body))})))(e,t);return t.id=n.id,yield((e,t)=>(0,a.mG)(void 0,void 0,void 0,(function*(){if(!t.id)throw new Error("Can not save image for unsaved bundle group");if(!t.newImage&&!t.clearImage)return Promise.resolve();let n=u().patch("".concat(e).concat(t.id,"/")).set("Accept","application/json").set(F,A());t.newImage&&!t.clearImage?n=n.attach("image",t.newImage,t.newImage.name):t.clearImage&&(n=n.send({image:null})),yield n})))(e,t),n})))(this.props.bundleGroupURL,e),yield this.loadData(),this.setState({isSaving:!1}),this.onCloseModal()}catch(e){this.setState({isSaving:!1,formErrors:e.response.body})}})),this.onDeleteBundleGroup=e=>(0,a.mG)(this,void 0,void 0,(function*(){var t,n;return yield(t=this.props.bundleGroupURL,n=e,(0,a.mG)(void 0,void 0,void 0,(function*(){if(!n.id)throw new Error("Can not delete unsaved bundle group");yield u().delete("".concat(t).concat(n.id,"/")).set("Accept","application/json").set(F,A())}))),this.loadData()}))}componentDidMount(){this.loadData()}loadData(){return(0,a.mG)(this,void 0,void 0,(function*(){this.setState({isLoading:!0});const e=Promise.all([(t=this.props.bundleGroupURL,(0,a.mG)(void 0,void 0,void 0,(function*(){const e=yield u().options(t).set("Accept","application/json"),n=E(O.decode(e.body));return n.actions.POST?E(T.decode(n.actions.POST.bundle_type)).choices:[]}))),q(this.props.bundleGroupURL),X(this.props.concreteBundleProductChoiceURL),Q(this.props.userConfigurableBundleRangeChoiceURL)]);var t;const[n,r,s,i]=yield e;this.setBundleTypeChoices(n),this.setGroups(r),this.setProducts(s),this.setRanges(i),this.setState({isLoading:!1})}))}openCreateModal(){this.setState({selectedGroup:null,formErrors:{},editModalOpen:!0})}setGroups(e){this.idx=l()((function(){const t=this;t.ref("id"),t.field("name"),t.field("description"),e.forEach((e=>{t.add(e)}))})),this.setState({groups:e})}setBundleTypeChoices(e){this.setState({bundleTypeChoices:e})}setProducts(e){this.setState({products:e})}setRanges(e){this.setState({ranges:e})}getSearchResults(e){return this.idx?this.idx.search(e).map((e=>{const t=parseInt(e.ref,10);return this.state.groups.find((e=>e.id===t))})).filter((e=>!!e)):[]}buildGroupRows(){const e=this.state.searchText.trim(),t=e?this.getSearchResults(e):this.state.groups;if(this.state.isLoading)return r.createElement("tr",null,r.createElement("td",{colSpan:6},r.createElement("em",null,gettext("Loadingâ€¦"))));if(t.length<=0){const t=e?interpolate(gettext("No bundle groups found for search: %(searchText)s"),{searchText:e},!0):gettext("No bundle groups found.");return r.createElement("tr",null,r.createElement("td",{colSpan:6},t))}return t.map((e=>r.createElement(oe,{key:"".concat(e.id),bundleTypeChoices:this.state.bundleTypeChoices,group:e,products:this.state.products,ranges:this.state.ranges,onEdit:this.onOpenEditModal,onDelete:this.onDeleteBundleGroup})))}buildEditModal(){const e=this.state.groups.find((e=>e.id===this.state.selectedGroup));return r.createElement(c(),{contentLabel:gettext("Edit Bundle Group"),style:ce,isOpen:this.state.editModalOpen},r.createElement(ie,{bundleTypeChoices:this.state.bundleTypeChoices,group:e||null,products:this.state.products,ranges:this.state.ranges,isSaving:this.state.isSaving,errors:this.state.formErrors,onCancel:this.onCloseModal,onSave:this.onSaveBundleGroup}))}render(){return r.createElement("div",null,r.createElement("div",{className:"page-header"},r.createElement("a",{className:"btn btn-primary float-right",onClick:this.onCreate},r.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Create new bundle group")),r.createElement("h1",null,gettext("Bundle Groups"))),r.createElement("div",{className:"table-header"},r.createElement("h3",null,r.createElement("i",{className:"fas fa-search"}),gettext("Search Bundle Groups"))),r.createElement(V,{searchText:this.state.searchText,onChange:this.onSearchTextChange}),r.createElement("table",{className:"table table-striped table-bordered"},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("th",null,gettext("Name")),r.createElement("th",null,gettext("Type")),r.createElement("th",null,gettext("Image")),r.createElement("th",null,gettext("Triggers")),r.createElement("th",null,gettext("Suggestions")),r.createElement("th",null,gettext("Actions"))),this.buildGroupRows())),this.buildEditModal())}}var ue=de;!function(){const e=document.querySelector("#bundlegroup-table"),t=e.dataset.bundlegroupApi||"",n=e.dataset.concretebundleApi||"",a=e.dataset.concretebundleProductChoiceApi||"",i=e.dataset.userconfigurablebundleApi||"",l=e.dataset.userconfigurablebundleRangeChoiceApi||"",o=r.createElement(ue,{bundleGroupURL:t,concreteBundleURL:n,concreteBundleProductChoiceURL:a,userConfigurableBundleURL:i,userConfigurableBundleRangeChoiceURL:l});(0,s.render)(o,e)}()}},t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.m=e,n.x=function(){},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={678:0},t=[[2031,736]],r=function(){},s=function(s,a){for(var i,l,o=a[0],c=a[1],d=a[2],u=a[3],p=0,g=[];p<o.length;p++)l=o[p],n.o(e,l)&&e[l]&&g.push(e[l][0]),e[l]=0;for(i in c)n.o(c,i)&&(n.m[i]=c[i]);for(d&&d(n),s&&s(a);g.length;)g.shift()();return u&&t.push.apply(t,u),r()},a=self.webpackChunkdjango_oscar_bundles=self.webpackChunkdjango_oscar_bundles||[];function i(){for(var r,s=0;s<t.length;s++){for(var a=t[s],i=!0,l=1;l<a.length;l++){var o=a[l];0!==e[o]&&(i=!1)}i&&(t.splice(s--,1),r=n(n.s=a[0]))}return 0===t.length&&(n.x(),n.x=function(){}),r}a.forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a));var l=n.x;n.x=function(){return n.x=l||function(){},(r=i)()}}(),n.x()}();
//# sourceMappingURL=bundles.js.map